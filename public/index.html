<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>City Top-50 Prototype</title>
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
  <style>
    html,body{margin:0;padding:0;height:100%;width:100%;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;overflow:hidden}
    #map{position:absolute;top:0;left:0;right:0;bottom:0}
    .card-container{position:absolute;left:0;right:0;bottom:0;height:260px;pointer-events:none;display:flex;justify-content:center;background:linear-gradient(0deg,rgba(0,0,0,.25),rgba(0,0,0,0));backdrop-filter:blur(4px)}
    .swiper{width:92%;height:220px;margin:auto;pointer-events:auto}
    .swiper-slide{background:#fff;border-radius:20px;box-shadow:0 4px 12px rgba(0,0,0,.15);overflow:hidden;display:flex;flex-direction:column;padding:16px}
    .swiper-slide h3{margin:0 0 4px;font-size:18px;font-weight:600}
    .swiper-slide p{margin:0 0 8px;font-size:14px;color:#555;line-height:1.35}
    .swiper-slide .meta{margin-top:auto;font-size:12px;color:#888}
    .marker{width:36px;height:36px;border-radius:50%;background:#39d353;border:3px solid #fff;box-shadow:0 0 0 2px rgba(0,0,0,.15);transition:transform .2s ease}
    .marker.passive{background:#e4e4e4}
    .marker.active{transform:scale(1.2)}
  </style>
</head>
<body>
<div id="map"></div>
<div class="card-container">
  <div class="swiper">
    <div class="swiper-wrapper" id="slides"></div>
  </div>
</div>

<script src="https://mapgl.2gis.com/api/js"></script>
<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
<script>
  const LAT_MIN = 55.70, LAT_MAX = 55.80;
  const LNG_MIN = 37.55, LNG_MAX = 37.75;

  const companies = Array.from({length:50}, (_,i)=>({
      id:i,
      name:`Company ${i+1}`,
      desc:"This is a mock description for the company that can be replaced with real data.",
      coords:[
        +(LNG_MIN + Math.random()*(LNG_MAX-LNG_MIN)).toFixed(6),
        +(LAT_MIN + Math.random()*(LAT_MAX-LAT_MIN)).toFixed(6)
      ]
  }));

  const map = new mapgl.Map('map', {
    key: '10153539-2026-4a0c-b7a3-52ddb3fed411',
    center:[37.62,55.75],
    zoom:11
  });

  const markers = [];
  companies.forEach(c => {
    const el = document.createElement('div');
    el.className = 'marker passive';
    const mk = new mapgl.HtmlMarker(map, {coordinates:c.coords, html:el});
    markers.push({marker: mk, el});
  });

  const slideFrag = document.createDocumentFragment();
  companies.forEach(c => {
    const slide = document.createElement('div');
    slide.className = 'swiper-slide';
    slide.innerHTML = `<h3>${c.name}</h3><p>${c.desc}</p><div class="meta">Lat: ${c.coords[1].toFixed(3)}, Lng: ${c.coords[0].toFixed(3)}</div>`;
    slideFrag.appendChild(slide);
  });
  document.getElementById('slides').appendChild(slideFrag);

  const swiper = new Swiper('.swiper', {
    slidesPerView:1,
    spaceBetween:12,
    centeredSlides:true,
    loop:false,
    grabCursor:true,
    resistanceRatio:0.5,
    on:{
      init(){ highlightMarker(this.activeIndex); flyToMarker(this.activeIndex); },
      slideChange(){ highlightMarker(this.activeIndex); flyToMarker(this.activeIndex); }
    }
  });

  function highlightMarker(idx){
    markers.forEach((m,i)=>{
      if(i===idx){
        m.el.classList.remove('passive');
        m.el.classList.add('active');
      } else {
        m.el.classList.remove('active');
        m.el.classList.add('passive');
      }
    });
  }

  function flyToMarker(idx){
    const {coords} = companies[idx];
    map.setCenter(coords);
    map.setZoom(14);
  }

  markers.forEach((m,i)=>{
    m.el.addEventListener('click',()=>{
      swiper.slideTo(i);
    });
  });
</script>
</body>
</html>
